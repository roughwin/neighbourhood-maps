function init(){window.clearTimeout(mapTimeout),map=new BMap.Map("map",{enableMapClick:!1}),initMarker(BMap.Marker.prototype),(new BMap.Geolocation).getCurrentPosition(function(e){this.getStatus()==BMAP_STATUS_SUCCESS?map.panTo(e.point):alert("定位失败： "+this.getStatus()),loadData(model.items)},{enableHighAccuracy:!0}),convert(new BMap.Point(120.11222183704376,30.284863403785405),function(e){map.centerAndZoom(e.points[0],17),map.addControl(new BMap.MapTypeControl),map.setCurrentCity("杭州"),map.enableScrollWheelZoom(!0)}),model.infoWindow=new BMap.InfoWindow}function convert(e,t){var o=new BMap.Convertor,i=[];i.push(e),o.translate(i,3,5,t)}function initMarker(e){e.setLarge=function(){this.selected=!0,window.setTimeout(function(){this.selected&&(this.getMap().panTo(this.position),this.showLabel(),this.setAnimation(BMAP_ANIMATION_BOUNCE))}.bind(this),200)},e.showLabel=function(){this.setTop(!0),this.setLabel(new BMap.Label(this.title,{offset:new BMap.Size(20,-10)}))},e.setNormal=function(){this.selected=!1,this.setAnimation(null),this.setTop(!1),this.getMap().removeOverlay(this.getLabel())},e.openWindow=function(){model.infoWindow.setContent(this.stationInfo),this.openInfoWindow(model.infoWindow),this.windowOpen=!0},e.toggleWindow=function(){window.clickDelay||(window.clickDelay=!0,window.setTimeout(function(){if(window.clickDelay=!1,this.windowOpen)return void this.closeInfoWindow();this.openWindow()}.bind(this),200))},e.setWindowClose=function(){this.windowOpen=!1}}function toggleside(){$(".container").toggleClass("side-hide")}function loadData(e){function t(e){if(n.getStatus()==BMAP_STATUS_SUCCESS){o(e);var t=e.getPageIndex()+1;t<e.getNumPages()&&n.gotoPage(t)}}function o(t){for(var o,i=0;i<t.getCurrentNumPois();i++){o=t.getPoi(i);var n=new BMap.Marker(o.point);n.title=o.title,n.visible=!0,n.selected=!1,n.stationInfo=o.address,n.position=o.point,n.open=!1,n.addEventListener("click",n.toggleWindow),n.addEventListener("mouseover",n.showLabel),n.addEventListener("mouseout",n.setNormal),n.addEventListener("infowindowclose",n.setWindowClose),e.push(n),map.addOverlay(n)}}map.clearOverlays(),e.removeAll();var i={pageCapacity:10,onSearchComplete:t},n=new BMap.LocalSearch(map,i);n.searchInBounds("公交站",map.getBounds())}function showList(){$(".sidebar ul").addClass("show")}function hideList(){window.setTimeout(function(){$(".show").toggleClass("show")},100)}function inputChange(e){return window.clearTimeout(window.keypressTimer),window.keypressTimer=window.setTimeout(function(){var t=e.inputval(),o=e.items().map(function(e,o){return e.title.match(t)?(e.visible=!0,e.show()):(e.visible=!1,e.hide()),e});e.items.removeAll(),e.items(o)},500),!0}function gm_authFailure(){model.tips("Google Map无权访问")}var map,model={inputval:ko.observable(),items:ko.observableArray(),infoWindow:void 0,tips:ko.observable("")};ko.applyBindings(model);var mapTimeout=setTimeout(function(){model.tips("地图加载超时")},5e3);