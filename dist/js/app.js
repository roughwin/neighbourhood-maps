function init(){icon={url:"./img/spotlight-poi_hdpi.png",size:new google.maps.Size(44,80),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(5.5,20),scaledSize:new google.maps.Size(11,20)},icon_large={url:"./img/spotlight-poi_hdpi.png",size:new google.maps.Size(44,80),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(11,40),scaledSize:new google.maps.Size(22,40)},google.maps.Marker.prototype.setLarge=function(){this.selected=!0,this.setSelect()},google.maps.Marker.prototype.setNormal=function(){this.selected=!1,this.setSelect()},google.maps.Marker.prototype.setSelect=function(){if(this.selected)return void this.setIcon(icon_large);this.setIcon(icon)},google.maps.Marker.prototype.openWindow=function(){model.infoWindow.close(),model.infoWindow.open(map),model.infoWindow.setContent(this.stationInfo),model.infoWindow.setPosition(this.position)},map=new google.maps.Map(document.getElementById("map"),{center:{lat:30.286077066609675,lng:120.11394867673516},zoom:15}),map.addListener("click",function(){model.infoWindow.close()}),model.infoWindow=new google.maps.InfoWindow,loadData(model.items,function(e){getDetail(e().map(function(e,o){return e.title}),function(o){e(e().map(function(e,n){return e.stationInfo=o[e.title],e}))}),dispMarker(model.items)}.bind(null,model.items))}function dispMarker(e){e().forEach(function(e,o){e.setMap(map)})}function loadData(e,o){var n=new google.maps.places.PlacesService(map),t={location:{lat:30.284863403785405,lng:120.11222183704376},query:"bus stop"};n.textSearch(t,function(n,t){e.removeAll(),n.forEach(function(o,n){var t=new google.maps.Marker({position:{lat:o.geometry.location.lat(),lng:o.geometry.location.lng()},title:o.name,icon:icon,zIndex:1,selected:!1,stationInfo:"loading.."});t.addListener("click",t.openWindow),e.push(t)}),o(),ko.applyBindings(model)})}function showList(){$(".sidebar ul").addClass("show")}function hideList(){window.setTimeout(function(){$(".show").toggleClass("show")},100)}function inputChange(e){var o=e.inputval(),n=e.items().map(function(e,n){return e.title.match(o)?e.visible=!0:e.visible=!1,e.setMap(map),e});e.infoWindow.close(),e.items.removeAll(),e.items(n)}function getDetail(e,o){var n=new XMLHttpRequest;n.timeout=3e3,n.responseType="",n.onload=function(){o(JSON.parse(this.responseText))};var t={city:"杭州",s:e};n.open("post","http://busapi.applinzi.com/api",!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(encodeFormData(t))}function encodeFormData(e){if(!e)return"";var o=[];for(var n in e)if(e.hasOwnProperty(n)&&"function"!=typeof e[n]){var t=e[n].toString();n=encodeURIComponent(n.replace("%20","+")),t=encodeURIComponent(t.replace("%20","+")),o.push(n+"="+t)}return o.join("&")}var map,model={inputval:ko.observable(),items:ko.observableArray(),infoWindow:void 0},icon,icon_large;