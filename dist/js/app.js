function init(){var e=google.maps;icon={url:"./img/spotlight-poi_hdpi.png",size:new e.Size(44,80),origin:new e.Point(0,0),anchor:new e.Point(5.5,20),scaledSize:new e.Size(11,20)},icon_large={url:"./img/spotlight-poi_hdpi.png",size:new e.Size(44,80),origin:new e.Point(0,0),anchor:new e.Point(11,40),scaledSize:new e.Size(22,40)},initMarker(e.Marker.prototype),map=new e.Map(document.getElementById("map"),{center:{lat:30.286077066609675,lng:120.11394867673516},zoom:15}),map.addListener("click",function(){model.infoWindow.close()}),model.infoWindow=new e.InfoWindow,loadData(model.items,function(e){getDetail(e().map(function(e,n){return e.title}),function(n){e(e().map(function(e,o){return e.stationInfo="lost"==n[e.title]?"车站信息暂未收录":n[e.title],e}))}),dispMarker(model.items)}.bind(null,model.items))}function initMarker(e){e.setLarge=function(){this.selected=!0,this.setSelect()},e.setNormal=function(){this.selected=!1,this.setSelect()},e.setSelect=function(){if(this.selected)return void this.setIcon(icon_large);this.setIcon(icon)},e.openWindow=function(){model.infoWindow.close(),model.infoWindow.open(map),model.infoWindow.setContent(this.stationInfo),model.infoWindow.setPosition(this.position)}}function dispMarker(e){e().forEach(function(e,n){e.setMap(map)})}function loadData(e,n){var o=new google.maps.places.PlacesService(map),i={location:{lat:30.284863403785405,lng:120.11222183704376},query:"bus stop"};o.textSearch(i,function(o,i){e.removeAll(),o.forEach(function(n,o){var i=new google.maps.Marker({position:{lat:n.geometry.location.lat(),lng:n.geometry.location.lng()},title:n.name,icon:icon,zIndex:1,selected:!1,stationInfo:"loading.."});i.addListener("click",i.openWindow),e.push(i)}),n(),ko.applyBindings(model)})}function showList(){$(".sidebar ul").addClass("show")}function hideList(){window.setTimeout(function(){$(".show").toggleClass("show")},100)}function inputChange(e){return window.clearTimeout(window.keypressTimer),window.keypressTimer=window.setTimeout(function(){var n=e.inputval(),o=e.items().map(function(e,o){return e.title.match(n)?e.visible=!0:e.visible=!1,e.setMap(map),e});e.infoWindow.close(),e.items.removeAll(),e.items(o)},500),!0}function getDetail(e,n){var o=new XMLHttpRequest;o.timeout=3e3,o.responseType="",o.onload=function(){n(JSON.parse(this.responseText))};var i={city:"杭州",s:e};o.open("post","http://busapi.applinzi.com/api",!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(encodeFormData(i)),o.timeout=function(){alert("车站信息加载超时")},o.error=function(){console.log("网络异常。")}}function encodeFormData(e){if(!e)return"";var n=[];for(var o in e)if(e.hasOwnProperty(o)&&"function"!=typeof e[o]){var i=e[o].toString();o=encodeURIComponent(o.replace("%20","+")),i=encodeURIComponent(i.replace("%20","+")),n.push(o+"="+i)}return n.join("&")}var map,model={inputval:ko.observable(),items:ko.observableArray(),infoWindow:void 0},icon,icon_large;