function init(){if(window.clearTimeout(mapTimeout),!google.maps)return void console.log("load fail.");var e=google.maps;icon={url:"./img/spotlight-poi_hdpi.png",size:new e.Size(44,80),origin:new e.Point(0,0),anchor:new e.Point(5.5,20),scaledSize:new e.Size(11,20)},icon_large={url:"./img/spotlight-poi_hdpi.png",size:new e.Size(44,80),origin:new e.Point(0,0),anchor:new e.Point(11,40),scaledSize:new e.Size(22,40)},initMarker(e.Marker.prototype),map=new e.Map(document.getElementById("map"),{center:{lat:30.286077066609675,lng:120.11394867673516},zoom:15}),map.addListener("click",function(){model.infoWindow.close()}),model.infoWindow=new e.InfoWindow,model.infoWindow.setOptions({pixelOffset:new google.maps.Size(0,-10)}),loadData(model.items,function(e){getDetail(e().map(function(e,o){return e.title}),function(o){e(e().map(function(e,n){return e.stationInfo="lost"==o[e.title]?"车站信息暂未收录":o[e.title],e}))}),dispMarker(model.items)}.bind(null,model.items))}function initMarker(e){e.setLarge=function(){this.selected=!0,this.setSelect()},e.setNormal=function(){this.selected=!1,this.setSelect()},e.setSelect=function(){if(this.selected)return void this.setIcon(icon_large);this.setIcon(icon)},e.openWindow=function(){model.infoWindow.close(),model.infoWindow.open(map),model.infoWindow.setContent(this.stationInfo),model.infoWindow.setPosition(this.position)}}function toggleside(){$(".container").toggleClass("side-hide")}function dispMarker(e){e().forEach(function(e,o){e.setMap(map)})}function loadData(e,o){var n=new google.maps.places.PlacesService(map),i={location:{lat:30.284863403785405,lng:120.11222183704376},query:"bus stop"};n.textSearch(i,function(n,i){e.removeAll(),n.forEach(function(o,n){var i=new google.maps.Marker({position:{lat:o.geometry.location.lat(),lng:o.geometry.location.lng()},title:o.name,icon:icon,zIndex:1,selected:!1,stationInfo:"loading.."});i.addListener("click",i.openWindow),e.push(i)}),o()})}function showList(){$(".sidebar ul").addClass("show")}function hideList(){window.setTimeout(function(){$(".show").toggleClass("show")},100)}function inputChange(e){return window.clearTimeout(window.keypressTimer),window.keypressTimer=window.setTimeout(function(){var o=e.inputval(),n=e.items().map(function(e,n){return e.title.match(o)?e.visible=!0:e.visible=!1,e.setMap(map),e});e.infoWindow.close(),e.items.removeAll(),e.items(n)},500),!0}function getDetail(e,o){var n=new XMLHttpRequest;n.timeout=3e3,n.responseType="",n.onload=function(){o(JSON.parse(this.responseText))};var i={city:"杭州",s:e};n.open("post","http://busapi.applinzi.com/api",!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(encodeFormData(i)),n.timeout=function(){alert("车站信息加载超时")},n.error=function(){console.log("网络异常。")}}function encodeFormData(e){if(!e)return"";var o=[];for(var n in e)if(e.hasOwnProperty(n)&&"function"!=typeof e[n]){var i=e[n].toString();n=encodeURIComponent(n.replace("%20","+")),i=encodeURIComponent(i.replace("%20","+")),o.push(n+"="+i)}return o.join("&")}function gm_authFailure(){model.tips("Google Map无权访问")}var map,model={inputval:ko.observable(),items:ko.observableArray(),infoWindow:void 0,tips:ko.observable("")};ko.applyBindings(model);var mapTimeout=setTimeout(function(){model.tips("地图加载超时")},5e3),icon,icon_large;